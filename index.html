<!doctype html>
<html>
	<meta charset="utf-8">
	<head>
		<title>Keeb's Quest - An Adventure in Typing</title>
	</head>
	<style>
		.typed { font-size: 24px; color: blue; }
	</style>
<body>
<script src="lib/flyd.min.js"></script>
<script src="lib/mithril.min.js"></script>
<script>
//  The Meiosis Pattern  -  http://meiosis.js.org
// ------------------------------------------------
// I'm rewinding this to Tutorial Step 03 "Streams"
// so that I can build it forward as needed.
// Using Flyd as the stream library.
var initial_state = { typed_str: "" };
var actions = {
	add_char: function(c){ update(c) },
}
var update = flyd.stream();
var states = flyd.scan(function(state, c){
	state.typed_str+=c;
	return state;
}, initial_state, update);

// For now, just limit to keys you might type while
// writing a novel. :-)
var key_ok = /^[A-Za-z0-9,.?!'" ]$/;
document.addEventListener("keydown", function(e){
	if(! key_ok.test(e.key)) return;
	str+=e.key;
	m.redraw();
});

// Mithril.js component - just a view for rendering.
var game = {
	view: function(){
		return [
			m("h1", "Keeb's Quest"),
			m("p", "I can type!"),
			m(".typed", str),
		];
	},
}
m.mount(document.body, game);
</script>
</body>
</html>

